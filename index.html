<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß IPTV Control Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            margin: 100px auto;
        }
        .auth-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .hidden { display: none !important; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 5px;
        }
        .online { background: #d4edda; color: #155724; }
        .offline { background: #f8d7da; color: #721c24; }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            box-sizing: border-box;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
        }
        .api-endpoint {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        code { background: #e9ecef; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="auth-container" class="auth-container">
        <h1>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ GitHub Personal Access Token –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</p>
        <input type="password" id="auth-token" class="auth-input" placeholder="GitHub Personal Access Token" autocomplete="off">
        <button class="btn btn-success" onclick="authenticate()" style="width: 100%; margin-top: 10px;">üîì –í–æ–π—Ç–∏</button>
        <div id="auth-error" style="color: red; margin-top: 10px; display: none;"></div>
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; font-size: 12px; text-align: left;">
            <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:</strong><br>
            1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings ‚Üí Tokens</a><br>
            2. –°–æ–∑–¥–∞–π—Ç–µ Personal Access Token<br>
            3. –í—ã–±–µ—Ä–∏—Ç–µ scopes: <code>repo</code>, <code>workflow</code><br>
            4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤–≤–µ–¥–∏—Ç–µ –≤—ã—à–µ
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="main-content" class="hidden">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
        <div class="container">
            <h1>üîß IPTV Control Panel</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IPTV –∫–∞–Ω–∞–ª–∞–º–∏ –¥–ª—è Android TV</p>
            <div style="text-align: right;">
                <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
            <div id="service-status"></div>
        </div>

    <!-- –¢–∞–±—ã -->
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('public')">üìä –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
            <button class="tab" onclick="showTab('admin')">üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="public" class="tab-content active">
            <h2>üìã API Endpoints</h2>
            
            <div class="api-endpoint">
                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                <code>GET /api/config.json</code>
                <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å–µ —Å–µ—Ä–≤–∏—Å–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–∞–Ω–∞–ª–æ–≤</p>
            </div>
            
            <div class="api-endpoint">
                <h3>–°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤</h3>
                <code>GET /files/channels.m3u8</code>
                <p>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ IPTV –∫–∞–Ω–∞–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ M3U8</p>
            </div>
            
            <div class="api-endpoint">
                <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <code>GET /files/security_config.xml</code>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è Android</p>
            </div>
            
            <h2>üì± –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h2>
            <p>–ë–∞–∑–æ–≤—ã–π URL: <code>https://artemon4es.github.io/tv-channels-api</code></p>
            <p>API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</p>
            
            <h2>üîß –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
            <div id="system-status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ -->
        <div id="admin" class="tab-content">
            <div class="control-panel">
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º -->
                <div class="section">
                    <h3>üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º</h3>
                    <button class="btn btn-success" onclick="enableService()">‚úÖ –í–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å</button>
                    <button class="btn btn-danger" onclick="disableService()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å</button>
                    <br><br>
                    <label>–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</label>
                    <textarea id="service-message" placeholder="–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω.\n–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É." style="height: 80px;"></textarea>
                    <button class="btn" onclick="updateServiceMessage()">–û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ -->
                <div class="section">
                    <h3>üì∫ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏</h3>
                    <input type="file" id="channels-file" accept=".m3u8,.m3u">
                    <button class="btn" onclick="uploadChannels()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–Ω–∞–ª—ã</button>
                    <br><br>
                    <h4>–ò–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ:</h4>
                    <textarea id="channels-content" style="height: 120px;"></textarea>
                    <button class="btn btn-success" onclick="saveChannels()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ APK -->
                <div class="section">
                    <h3>üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ APK</h3>
                    <input type="text" id="new-version" placeholder="1.2" style="width: 100px;">
                    <input type="file" id="apk-file" accept=".apk">
                    <button class="btn btn-success" onclick="uploadAPK()">–ó–∞–≥—Ä—É–∑–∏—Ç—å APK</button>
                    <br><br>
                    <label>Changelog:</label>
                    <textarea id="changelog" placeholder="üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏\n‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" style="height: 60px;"></textarea>
                    <label>
                        <input type="checkbox" id="update-required"> –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    </label>
                </div>

                <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
                <div class="section">
                    <h3>üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                    <textarea id="security-domains" placeholder="example.com&#10;cdn.example.com" style="height: 80px;"></textarea>
                    <button class="btn" onclick="updateSecurity()">–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–º–µ–Ω—ã</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π -->
    <div class="container">
        <h2>üìã –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <div id="operation-log" class="log">
            [–°–ò–°–¢–ï–ú–ê] Control Panel –∑–∞–≥—Ä—É–∂–µ–Ω
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function loadCurrentConfig() {
            try {
                const response = await fetch('./api/config.json');
                const config = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateServiceStatus(config);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–Ω–∞–ª–æ–≤
                const channelsResponse = await fetch('./files/channels.m3u8');
                const channelsContent = await channelsResponse.text();
                document.getElementById('channels-content').value = channelsContent;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                document.getElementById('system-status').innerHTML = `
                    <p><strong>–°–µ—Ä–≤–∏—Å:</strong> ${config.service_config.service_available ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</p>
                    <p><strong>–í–µ—Ä—Å–∏—è –∫–∞–Ω–∞–ª–æ–≤:</strong> ${config.channels_config.version}</p>
                    <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> ${new Date(config.channels_config.last_updated).toLocaleString()}</p>
                    <p><strong>–í–µ—Ä—Å–∏—è APK:</strong> ${config.app_info.current_version} ‚Üí ${config.app_info.latest_version}</p>
                    ${config.service_config.message ? `<p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${config.service_config.message}</p>` : ''}
                `;
                
                log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + error.message);
            }
        }

        function updateServiceStatus(config) {
            const statusDiv = document.getElementById('service-status');
            const isOnline = config.service_config.service_available;
            
            statusDiv.innerHTML = `
                <span class="status-indicator ${isOnline ? 'online' : 'offline'}">
                    ${isOnline ? 'üü¢ –°–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –°–µ—Ä–≤–∏—Å –æ—Ç–∫–ª—é—á–µ–Ω'}
                </span>
                <p><strong>–í–µ—Ä—Å–∏—è –∫–∞–Ω–∞–ª–æ–≤:</strong> ${config.channels_config.version}</p>
                <p><strong>–í–µ—Ä—Å–∏—è APK:</strong> ${config.app_info.current_version} ‚Üí ${config.app_info.latest_version}</p>
            `;
        }

        function enableService() {
            updateConfigField('service_config.service_available', true);
            updateConfigField('service_config.message', '');
            log('‚úÖ –°–µ—Ä–≤–∏—Å –≤–∫–ª—é—á–µ–Ω');
        }

        function disableService() {
            const message = document.getElementById('service-message').value || 
                '–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω.\\n–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.';
            
            updateConfigField('service_config.service_available', false);
            updateConfigField('service_config.message', message);
            log('‚ùå –°–µ—Ä–≤–∏—Å –æ—Ç–∫–ª—é—á–µ–Ω');
        }

        function updateServiceMessage() {
            const message = document.getElementById('service-message').value;
            updateConfigField('service_config.message', message);
            log('üìù –°–æ–æ–±—â–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
        function saveChannels() {
            const content = document.getElementById('channels-content').value;
            
            if (!content.includes('#EXTM3U')) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å #EXTM3U');
                return;
            }
            
            const newVersion = Math.floor(Date.now() / 1000);
            log('üì∫ –ì–æ—Ç–æ–≤ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ (–≤–µ—Ä—Å–∏—è: ' + newVersion + ')');
            
            const instruction = `
                <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0; border: 1px solid #c3e6cb;">
                    <h4>üì∫ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤:</h4>
                    <ol>
                        <li><a href="https://github.com/artemon4es/tv-channels-api/edit/main/files/channels.m3u8" target="_blank">
                            –û—Ç–∫—Ä—ã—Ç—å channels.m3u8 –≤ GitHub</a></li>
                        <li>–ó–∞–º–µ–Ω–∏—Ç—å –≤–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏–º—ã–π —Ñ–∞–π–ª–∞ –Ω–∞ –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫</li>
                        <li>Commit changes</li>
                        <li><a href="https://github.com/artemon4es/tv-channels-api/edit/main/api/config.json" target="_blank">
                            –û—Ç–∫—Ä—ã—Ç—å config.json</a> –∏ –∏–∑–º–µ–Ω–∏—Ç—å:</li>
                        <li><code>"version": ${newVersion}</code></li>
                        <li><code>"last_updated": "${new Date().toISOString()}"</code></li>
                    </ol>
                    <button onclick="this.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', instruction);
        }

        function uploadChannels() {
            const channelsFile = document.getElementById('channels-file').files[0];
            
            if (!channelsFile) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∫–∞–Ω–∞–ª–æ–≤');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                if (!content.includes('#EXTM3U')) {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å #EXTM3U');
                    return;
                }
                
                document.getElementById('channels-content').value = content;
                log(`üì∫ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${channelsFile.name}`);
                saveChannels();
            };
            reader.readAsText(channelsFile);
        }

        function uploadAPK() {
            const newVersion = document.getElementById('new-version').value;
            const changelog = document.getElementById('changelog').value;
            const updateRequired = document.getElementById('update-required').checked;
            const apkFile = document.getElementById('apk-file').files[0];
            
            if (!newVersion) {
                alert('‚ùå –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é APK');
                return;
            }
            
            if (!apkFile) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ APK —Ñ–∞–π–ª');
                return;
            }
            
            log(`üì± –ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ APK v${newVersion} (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ: ${updateRequired})`);
            
            const instruction = `
                <div style="background: #cce5ff; padding: 15px; border-radius: 5px; margin: 10px 0; border: 1px solid #99d6ff;">
                    <h4>üì± –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ APK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</h4>
                    <p><strong>–§–∞–π–ª:</strong> ${apkFile.name} (${(apkFile.size / 1024 / 1024).toFixed(1)} MB)</p>
                    <ol>
                        <li><a href="https://github.com/artemon4es/tv-channels-api/upload/main/files/updates" target="_blank">
                            –û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É updates –≤ GitHub</a></li>
                        <li>–ó–∞–≥—Ä—É–∑–∏—Ç—å APK —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º: <code>app-v${newVersion}.apk</code></li>
                        <li>Commit changes</li>
                        <li><a href="https://github.com/artemon4es/tv-channels-api/edit/main/api/config.json" target="_blank">
                            –û—Ç–∫—Ä—ã—Ç—å config.json</a> –∏ –æ–±–Ω–æ–≤–∏—Ç—å:</li>
                    </ol>
                    <textarea readonly style="width: 100%; height: 80px; font-family: monospace; font-size: 11px;">"latest_version": "${newVersion}",
"version_code": ${newVersion.replace(/\./g, '')},
"download_url": "https://artemon4es.github.io/tv-channels-api/files/updates/app-v${newVersion}.apk",
"update_required": ${updateRequired},
"changelog": "${changelog.replace(/\n/g, '\\n')}"</textarea>
                    <button onclick="this.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-top: 5px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', instruction);
        }

        function updateSecurity() {
            const domains = document.getElementById('security-domains').value;
            
            if (!domains.trim()) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
                return;
            }
            
            const domainList = domains.split('\n').filter(d => d.trim());
            let xmlDomains = '';
            
            domainList.forEach(domain => {
                const cleanDomain = domain.trim();
                if (cleanDomain) {
                    xmlDomains += `        <domain includeSubdomains="true">${cleanDomain}</domain>\n`;
                }
            });
            
            log(`üîí –ì–æ—Ç–æ–≤ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é ${domainList.length} –¥–æ–º–µ–Ω–æ–≤`);
            
            const instruction = `
                <div style="background: #ffe6cc; padding: 15px; border-radius: 5px; margin: 10px 0; border: 1px solid #ffcc99;">
                    <h4>üîí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</h4>
                    <ol>
                        <li><a href="https://github.com/artemon4es/tv-channels-api/edit/main/files/security_config.xml" target="_blank">
                            –û—Ç–∫—Ä—ã—Ç—å security_config.xml –≤ GitHub</a></li>
                        <li>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –¥–æ–º–µ–Ω—ã –≤ —Å–µ–∫—Ü–∏—é &lt;domain-config&gt;:</li>
                        <li>Commit changes</li>
                    </ol>
                    <p><strong>–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏:</strong></p>
                    <textarea readonly style="width: 100%; height: 100px; font-family: monospace; font-size: 11px;">${xmlDomains}</textarea>
                    <button onclick="this.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-top: 5px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', instruction);
        }

        async function updateConfigField(field, value) {
            try {
                const response = await fetch('./api/config.json');
                const config = await response.json();
                
                const keys = field.split('.');
                let obj = config;
                for (let i = 0; i < keys.length - 1; i++) {
                    obj = obj[keys[i]];
                }
                obj[keys[keys.length - 1]] = value;
                
                log(`üîß –ì–æ—Ç–æ–≤–æ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é: ${field} = ${value}`);
                showGitHubInstructions(field, value, config);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        function showGitHubInstructions(field, value, config) {
            const instruction = `
                <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <h4>üìù –î–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:</h4>
                    <ol>
                        <li><a href="https://github.com/artemon4es/tv-channels-api/edit/main/api/config.json" target="_blank">
                            –û—Ç–∫—Ä—ã—Ç—å config.json –≤ GitHub</a></li>
                        <li>–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É: <code>"${field.split('.').pop()}": ...</code></li>
                        <li>–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞: <code>"${field.split('.').pop()}": ${typeof value === 'string' ? `"${value}"` : value}</code></li>
                        <li>–ù–∞–∂–∞—Ç—å "Commit changes"</li>
                    </ol>
                    <button onclick="this.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', instruction);
        }

        function log(message) {
            const logDiv = document.getElementById('operation-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `\n[${timestamp}] ${message}`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ===== –°–ò–°–¢–ï–ú–ê –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò =====
        let authToken = localStorage.getItem('github-token');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            if (authToken) {
                verifyToken(authToken);
            }
        };

        async function authenticate() {
            const token = document.getElementById('auth-token').value.trim();
            const errorDiv = document.getElementById('auth-error');
            
            if (!token) {
                showAuthError('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω');
                return;
            }
            
            errorDiv.style.display = 'none';
            document.querySelector('#auth-container .btn').textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            const isValid = await verifyToken(token);
            
            if (isValid) {
                authToken = token;
                localStorage.setItem('github-token', token);
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                loadCurrentConfig();
                setInterval(loadCurrentConfig, 30000);
            } else {
                document.querySelector('#auth-container .btn').textContent = 'üîì –í–æ–π—Ç–∏';
                showAuthError('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é');
            }
        }

        async function verifyToken(token) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
                const response = await fetch('https://api.github.com/repos/artemon4es/tv-channels-api', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const repo = await response.json();
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É —Ç–æ–∫–µ–Ω–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
                    return repo.permissions && repo.permissions.push;
                }
                
                return false;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:', error);
                return false;
            }
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('auth-error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('github-token');
            authToken = null;
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('auth-token').value = '';
        }

        // Enter key –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('auth-container').classList.contains('hidden')) {
                authenticate();
            }
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
        // loadCurrentConfig(); - —É–±—Ä–∞–Ω–æ, –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
        // setInterval(loadCurrentConfig, 30000); - —É–±—Ä–∞–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    </script>
    </div> <!-- –ó–∞–∫—Ä—ã—Ç–∏–µ main-content -->
</body>
</html> 