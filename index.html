<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß IPTV Control Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            margin: 100px auto;
        }
        .auth-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .hidden { display: none !important; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 5px;
        }
        .online { background: #d4edda; color: #155724; }
        .offline { background: #f8d7da; color: #721c24; }
        .service-status-big {
            background: #f8f9fa;
            border: 3px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .service-status-big.offline {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        .service-status-big.online {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        .service-status-big.changed {
            animation: statusChange 1s ease-in-out;
        }
        @keyframes statusChange {
            0% { transform: scale(1); box-shadow: none; }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(0,0,0,0.3); }
            100% { transform: scale(1); box-shadow: none; }
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            box-sizing: border-box;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
        }
        .api-endpoint {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        code { background: #e9ecef; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="auth-container" class="auth-container">
        <h1>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ GitHub Personal Access Token –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</p>
        <input type="password" id="auth-token" class="auth-input" placeholder="GitHub Personal Access Token" autocomplete="off">
        <button class="btn btn-success" onclick="authenticate()" style="width: 100%; margin-top: 10px;">üîì –í–æ–π—Ç–∏</button>
        <div id="auth-error" style="color: red; margin-top: 10px; display: none;"></div>
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; font-size: 12px; text-align: left;">
            <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:</strong><br>
            1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings ‚Üí Tokens</a><br>
            2. –°–æ–∑–¥–∞–π—Ç–µ Personal Access Token<br>
            3. –í—ã–±–µ—Ä–∏—Ç–µ scopes: <code>repo</code>, <code>workflow</code><br>
            4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤–≤–µ–¥–∏—Ç–µ –≤—ã—à–µ
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="main-content" class="hidden">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
        <div class="container">
            <h1>üîß IPTV Control Panel</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IPTV –∫–∞–Ω–∞–ª–∞–º–∏ –¥–ª—è Android TV</p>
            <div style="text-align: right;">
                <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
            <div id="service-status"></div>
        </div>

    <!-- –¢–∞–±—ã -->
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('public')">üìä –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
            <button class="tab" onclick="showTab('admin')">üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="public" class="tab-content active">
            <h2>üìã API Endpoints</h2>
            
            <div class="api-endpoint">
                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                <code>GET /api/config.json</code>
                <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å–µ —Å–µ—Ä–≤–∏—Å–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–∞–Ω–∞–ª–æ–≤</p>
            </div>
            
            <div class="api-endpoint">
                <h3>–°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤</h3>
                <code>GET /files/channels.m3u8</code>
                <p>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ IPTV –∫–∞–Ω–∞–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ M3U8</p>
            </div>
            
            <div class="api-endpoint">
                <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <code>GET /files/security_config.xml</code>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è Android</p>
            </div>
            
            <h2>üì± –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h2>
            <p>–ë–∞–∑–æ–≤—ã–π URL: <code>https://artemon4es.github.io/tv-channels-api</code></p>
            <p>API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</p>
            
            <h2>üîß –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
            <div id="system-status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button onclick="loadCurrentConfig()" style="margin-top: 10px; background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ -->
        <div id="admin" class="tab-content">
            <div class="control-panel">
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º -->
                <div class="section">
                    <h3>üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º</h3>
                    <div id="admin-service-status" class="service-status-big">
                        üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...
                    </div>
                    <button class="btn btn-success" onclick="enableService()">‚úÖ –í–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å</button>
                    <button class="btn btn-danger" onclick="disableService()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å</button>
                    <button class="btn" onclick="loadCurrentConfig()" style="background: #6c757d;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                    <br><br>
                    <div style="padding: 15px; background: #f0f8ff; border-radius: 5px; border-left: 4px solid #007bff;">
                        <p style="margin: 0; font-size: 14px; color: #0056b3;">
                            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:<br>
                            <em>"–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."</em>
                        </p>
                    </div>
                    <div style="padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107; margin-top: 10px;">
                        <p style="margin: 0; font-size: 14px; color: #856404;">
                            <strong>‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ GitHub Pages:</strong> –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 10 –º–∏–Ω—É—Ç –∏–∑-–∑–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è GitHub Pages. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
                        </p>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ -->
                <div class="section">
                    <h3>üì∫ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏</h3>
                    <input type="file" id="channels-file" accept=".m3u8,.m3u">
                    <button class="btn" onclick="uploadChannels()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–Ω–∞–ª—ã</button>
                    <br><br>
                    <h4>–ò–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ:</h4>
                    <textarea id="channels-content" style="height: 120px;"></textarea>
                    <button class="btn btn-success" onclick="saveChannels()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ APK -->
                <div class="section">
                    <h3>üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ APK</h3>
                    <input type="text" id="new-version" placeholder="1.2" style="width: 100px;">
                    <input type="file" id="apk-file" accept=".apk">
                    <button class="btn btn-success" onclick="uploadAPK()">–ó–∞–≥—Ä—É–∑–∏—Ç—å APK</button>
                    <br><br>
                    <label>Changelog:</label>
                    <textarea id="changelog" placeholder="üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏\n‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" style="height: 60px;"></textarea>
                    <label>
                        <input type="checkbox" id="update-required"> –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    </label>
                </div>

                <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
                <div class="section">
                    <h3>üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                    <textarea id="security-domains" placeholder="example.com&#10;cdn.example.com" style="height: 80px;"></textarea>
                    <button class="btn" onclick="updateSecurity()">–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–º–µ–Ω—ã</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π -->
    <div class="container">
        <h2>üìã –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <div id="operation-log" class="log">
            [–°–ò–°–¢–ï–ú–ê] Control Panel –∑–∞–≥—Ä—É–∂–µ–Ω
        </div>
        <button onclick="document.getElementById('operation-log').innerHTML = '[–°–ò–°–¢–ï–ú–ê] –õ–æ–≥ –æ—á–∏—â–µ–Ω'; log('üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω');" 
                style="margin-top: 10px; background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
            üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
        </button>
    </div>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        let previousServiceStatus = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function loadCurrentConfig() {
            try {
                // –ß–∏—Ç–∞–µ–º config.json —Å GitHub API, –∞ –Ω–µ –ª–æ–∫–∞–ª—å–Ω–æ
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/api/config.json?ref=main&t=${Date.now()}`, {
                    headers: {
                        'Authorization': `token ${authToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: HTTP ${response.status}`);
                }
                
                const fileData = await response.json();
                const configContent = atob(fileData.content);
                const config = JSON.parse(configContent);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
                const currentStatus = config.service_config.service_available;
                if (previousServiceStatus !== null && previousServiceStatus !== currentStatus) {
                    // –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    const statusText = currentStatus ? '–≤–∫–ª—é—á–µ–Ω' : '–æ—Ç–∫–ª—é—á–µ–Ω';
                    log(`üîÑ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ –∏–∑–º–µ–Ω–µ–Ω: ${statusText}`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    document.title = `${currentStatus ? 'üü¢' : 'üî¥'} IPTV Control Panel - –°–µ—Ä–≤–∏—Å ${statusText}`;
                    setTimeout(() => {
                        document.title = 'üîß IPTV Control Panel';
                    }, 5000);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    setTimeout(() => {
                        const statusDiv = document.getElementById('service-status');
                        const adminStatusDiv = document.getElementById('admin-service-status');
                        
                        if (statusDiv) {
                            const bigStatus = statusDiv.querySelector('.service-status-big');
                            if (bigStatus) {
                                bigStatus.classList.add('changed');
                                setTimeout(() => bigStatus.classList.remove('changed'), 1000);
                            }
                        }
                        
                        if (adminStatusDiv) {
                            adminStatusDiv.classList.add('changed');
                            setTimeout(() => adminStatusDiv.classList.remove('changed'), 1000);
                        }
                    }, 100);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
                previousServiceStatus = currentStatus;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateServiceStatus(config);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–Ω–∞–ª–æ–≤
                const channelsResponse = await fetch('./files/channels.m3u8');
                const channelsContent = await channelsResponse.text();
                document.getElementById('channels-content').value = channelsContent;
                
                // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—ã —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—É–±—Ä–∞–Ω–æ –ø–æ–ª–µ service-message)
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                document.getElementById('system-status').innerHTML = `
                    <p><strong>–°–µ—Ä–≤–∏—Å:</strong> ${config.service_config.service_available ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</p>
                    <p><strong>–í–µ—Ä—Å–∏—è –∫–∞–Ω–∞–ª–æ–≤:</strong> ${config.channels_config.version}</p>
                    <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> ${new Date(config.channels_config.last_updated).toLocaleString()}</p>
                    <p><strong>–í–µ—Ä—Å–∏—è APK:</strong> ${config.app_info.current_version} ‚Üí ${config.app_info.latest_version}</p>
                `;
                
                log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + error.message);
            }
        }

        function updateServiceStatus(config) {
            const statusDiv = document.getElementById('service-status');
            const adminStatusDiv = document.getElementById('admin-service-status');
            const isOnline = config.service_config.service_available;
            
            // –ë–æ–ª—å—à–æ–π —Å—Ç–∞—Ç—É—Å –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏
            statusDiv.innerHTML = `
                <div class="service-status-big ${isOnline ? 'online' : 'offline'}">
                    ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –ê–ö–¢–ò–í–ï–ù' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ï–ù'}
                    <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                        ${isOnline ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —ç–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏'}
                    </div>
                </div>
                <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                    <span class="status-indicator ${isOnline ? 'online' : 'offline'}">
                        ${isOnline ? 'üü¢ –°–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –°–µ—Ä–≤–∏—Å –æ—Ç–∫–ª—é—á–µ–Ω'}
                    </span>
                    <span style="background: #e9ecef; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                        üì∫ –ö–∞–Ω–∞–ª—ã: v${config.channels_config.version}
                    </span>
                    <span style="background: #e9ecef; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                        üì± APK: v${config.app_info.current_version} ‚Üí v${config.app_info.latest_version}
                    </span>
                </div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
            if (adminStatusDiv) {
                adminStatusDiv.className = `service-status-big ${isOnline ? 'online' : 'offline'}`;
                adminStatusDiv.innerHTML = `
                    ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –ê–ö–¢–ò–í–ï–ù' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ï–ù'}
                    <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                        ${isOnline ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —ç–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏'}
                    </div>
                `;
            }
        }

        async function enableService() {
            log('üîÑ –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞...');
            log('üîç DEBUG: –í—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è enableService()');
            
            try {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
                verifyConfigChange.attempts = 0;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è GitHub API
                if (!authToken) {
                    log('‚ö†Ô∏è –¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ.');
                    log('üí° –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ GitHub
                log('üîç DEBUG: –í—ã–∑—ã–≤–∞–µ–º updateConfigFieldDirect —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º TRUE');
                await updateConfigFieldDirect('service_config.service_available', true);
                await updateConfigFieldDirect('service_config.message', '');
                log('‚úÖ –°–µ—Ä–≤–∏—Å –≤–∫–ª—é—á–µ–Ω!');
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                showServiceStatusChange(true, '');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è GitHub Pages)
                setTimeout(async () => {
                    await verifyConfigChange(true);
                }, 5000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞: ${error.message}`);
                
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–æ–∫–µ–Ω–æ–º, –¥–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                if (error.message.includes('token') || error.message.includes('401') || error.message.includes('403')) {
                    log('üîë –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω GitHub –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    log('üí° –í–æ–∑–º–æ–∂–Ω–æ, —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞');
                } else {
                    log('üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥');
                }
                
                // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
                setTimeout(loadCurrentConfig, 2000);
            }
        }

        async function disableService() {
            log('üîÑ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞...');
            log('üîç DEBUG: –í—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è disableService()');
            
            try {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
                verifyConfigChange.attempts = 0;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è GitHub API
                if (!authToken) {
                    log('‚ö†Ô∏è –¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ.');
                    log('üí° –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ GitHub
                log('üîç DEBUG: –í—ã–∑—ã–≤–∞–µ–º updateConfigFieldDirect —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º FALSE');
                await updateConfigFieldDirect('service_config.service_available', false);
                await updateConfigFieldDirect('service_config.message', '');
                log('‚ùå –°–µ—Ä–≤–∏—Å –æ—Ç–∫–ª—é—á–µ–Ω!');
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                showServiceStatusChange(false, '');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è GitHub Pages)
                setTimeout(async () => {
                    await verifyConfigChange(false);
                }, 5000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞: ${error.message}`);
                
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–æ–∫–µ–Ω–æ–º, –¥–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                if (error.message.includes('token') || error.message.includes('401') || error.message.includes('403')) {
                    log('üîë –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω GitHub –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    log('üí° –í–æ–∑–º–æ–∂–Ω–æ, —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞');
                } else {
                    log('üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥');
                }
                
                // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
                setTimeout(loadCurrentConfig, 2000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function showServiceStatusChange(isOnline, message) {
            const statusDiv = document.getElementById('service-status');
            const adminStatusDiv = document.getElementById('admin-service-status');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.title = `${isOnline ? 'üü¢' : 'üî¥'} IPTV Control Panel - ${isOnline ? '–í–∫–ª—é—á–∞–µ–º' : '–û—Ç–∫–ª—é—á–∞–µ–º'} —Å–µ—Ä–≤–∏—Å...`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞–ø—Ä—è–º—É—é –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div class="service-status-big ${isOnline ? 'online' : 'offline'} changed">
                        ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –í–ö–õ–Æ–ß–ê–ï–¢–°–Ø...' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ê–ï–¢–°–Ø...'}
                        <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                            ${isOnline ? '–û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...' : '–ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <span class="status-indicator ${isOnline ? 'online' : 'offline'}">
                            ${isOnline ? 'üü¢ –í–∫–ª—é—á–µ–Ω–∏–µ...' : 'üî¥ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ...'}
                        </span>
                        <span style="background: #ffc107; color: #212529; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                            ‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...
                        </span>
                    </div>
                `;
            }
            
            if (adminStatusDiv) {
                adminStatusDiv.className = `service-status-big ${isOnline ? 'online' : 'offline'} changed`;
                adminStatusDiv.innerHTML = `
                    ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –í–ö–õ–Æ–ß–ê–ï–¢–°–Ø...' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ê–ï–¢–°–Ø...'}
                    <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                        ${isOnline ? '–û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...' : '–ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...'}
                    </div>
                `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function verifyConfigChange(expectedStatus) {
            try {
                log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
                
                let config = null;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ GitHub API (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω)
                if (authToken) {
                    try {
                        const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/api/config.json?ref=main&t=${Date.now()}`, {
                            headers: {
                                'Authorization': `token ${authToken}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0'
                            }
                        });
                        
                        if (response.ok) {
                            const fileData = await response.json();
                            const decodedContent = atob(fileData.content);
                            config = JSON.parse(decodedContent);
                            log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ GitHub API');
                        } else {
                            log(`‚ö†Ô∏è GitHub API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (${response.status}), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥`);
                        }
                    } catch (apiError) {
                        log(`‚ö†Ô∏è GitHub API –æ—à–∏–±–∫–∞: ${apiError.message}, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥`);
                    }
                }
                
                // –ï—Å–ª–∏ GitHub API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
                if (!config) {
                    try {
                        const response = await fetch(`./api/config.json?t=${Date.now()}`, {
                            headers: {
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0'
                            }
                        });
                        
                        if (response.ok) {
                            config = await response.json();
                            log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ GitHub Pages');
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (pagesError) {
                        throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: ${pagesError.message}`);
                    }
                }
                
                const actualStatus = config.service_config.service_available;
                
                if (actualStatus === expectedStatus) {
                    log('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
                    verifyConfigChange.attempts = 0;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    updateServiceStatus(config);
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    document.title = 'üîß IPTV Control Panel';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —É—Å–ø–µ—Ö–∞
                    const statusDiv = document.getElementById('service-status');
                    const adminStatusDiv = document.getElementById('admin-service-status');
                    
                    if (statusDiv) {
                        const bigStatus = statusDiv.querySelector('.service-status-big');
                        if (bigStatus) {
                            bigStatus.classList.add('changed');
                            setTimeout(() => bigStatus.classList.remove('changed'), 1000);
                        }
                    }
                    
                    if (adminStatusDiv) {
                        adminStatusDiv.classList.add('changed');
                        setTimeout(() => adminStatusDiv.classList.remove('changed'), 1000);
                    }
                    
                } else {
                    log(`‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å. –û–∂–∏–¥–∞–µ–º: ${expectedStatus}, –ø–æ–ª—É—á–∏–ª–∏: ${actualStatus}`);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
                    if (!verifyConfigChange.attempts) {
                        verifyConfigChange.attempts = 0;
                    }
                    verifyConfigChange.attempts++;
                    
                                         if (verifyConfigChange.attempts < 10) {
                         // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                         const delay = Math.min(5000 + (verifyConfigChange.attempts * 2000), 15000);
                         log(`üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ ${delay/1000} —Å–µ–∫—É–Ω–¥... (–ø–æ–ø—ã—Ç–∫–∞ ${verifyConfigChange.attempts}/10)`);
                         
                         // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å–ª–µ 3-—Ö –ø–æ–ø—ã—Ç–æ–∫
                         if (verifyConfigChange.attempts >= 3) {
                             log('üí° –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - GitHub Pages –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π. –ü–æ–¥–æ–∂–¥–∏—Ç–µ...');
                         }
                         
                         setTimeout(async () => {
                             await verifyConfigChange(expectedStatus);
                         }, delay);
                     } else {
                        log('‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ (10)');
                        log('üí° GitHub Pages –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–æ 10 –º–∏–Ω—É—Ç. –ò–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.');
                        log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ...');
                        
                        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –æ–∂–∏–¥–∞–µ–º—ã–º —Å—Ç–∞—Ç—É—Å–æ–º
                        const mockConfig = {
                            service_config: {
                                service_available: expectedStatus,
                                message: ''
                            },
                            channels_config: { version: 'loading...' },
                            app_info: { 
                                current_version: 'loading...',
                                latest_version: 'loading...'
                            }
                        };
                        updateServiceStatus(mockConfig);
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
                        verifyConfigChange.attempts = 0;
                        
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                        document.title = 'üîß IPTV Control Panel';
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
                        setTimeout(loadCurrentConfig, 30000);
                    }
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${error.message}`);
                log('üîÑ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–±—ã—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                verifyConfigChange.attempts = 0;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
                setTimeout(loadCurrentConfig, 2000);
            }
        }

        // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï —Ñ—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
        async function saveChannels() {
            const content = document.getElementById('channels-content').value;
            
            if (!content.includes('#EXTM3U')) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å #EXTM3U');
                return;
            }
            
            const newVersion = Math.floor(Date.now() / 1000);
            log('üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤...');
            
            try {
                // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª –∫–∞–Ω–∞–ª–æ–≤
                await updateGitHubFile('files/channels.m3u8', content, `üì∫ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ v${newVersion}`);
                log('‚úÖ –§–∞–π–ª –∫–∞–Ω–∞–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                
                // 2. –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                await updateConfigFieldDirect('channels_config.version', newVersion);
                await updateConfigFieldDirect('channels_config.last_updated', new Date().toISOString());
                log('‚úÖ –í–µ—Ä—Å–∏—è –∫–∞–Ω–∞–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                
                setTimeout(loadCurrentConfig, 2000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤: ${error.message}`);
            }
        }

        function uploadChannels() {
            const channelsFile = document.getElementById('channels-file').files[0];
            
            if (!channelsFile) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∫–∞–Ω–∞–ª–æ–≤');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                if (!content.includes('#EXTM3U')) {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å #EXTM3U');
                    return;
                }
                
                document.getElementById('channels-content').value = content;
                log(`üì∫ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${channelsFile.name}`);
                saveChannels();
            };
            reader.readAsText(channelsFile);
        }

        async function uploadAPK() {
            const newVersion = document.getElementById('new-version').value;
            const changelog = document.getElementById('changelog').value;
            const updateRequired = document.getElementById('update-required').checked;
            const apkFile = document.getElementById('apk-file').files[0];
            
            if (!newVersion) {
                alert('‚ùå –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é APK');
                return;
            }
            
            if (!apkFile) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ APK —Ñ–∞–π–ª');
                return;
            }
            
            log(`üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ APK v${newVersion} (${(apkFile.size / 1024 / 1024).toFixed(1)} MB)...`);
            
            try {
                // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ binary
                const arrayBuffer = await apkFile.arrayBuffer();
                const base64Content = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º APK —Ñ–∞–π–ª
                const fileName = `app-v${newVersion}.apk`;
                await updateGitHubFile(`files/updates/${fileName}`, base64Content, `üì± –î–æ–±–∞–≤–ª–µ–Ω–∏–µ APK v${newVersion}`, true);
                log('‚úÖ APK —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                await updateConfigFieldDirect('app_info.latest_version', newVersion);
                await updateConfigFieldDirect('app_info.version_code', parseInt(newVersion.replace(/\./g, '')));
                await updateConfigFieldDirect('app_info.download_url', `https://artemon4es.github.io/tv-channels-api/files/updates/${fileName}`);
                await updateConfigFieldDirect('app_info.update_required', updateRequired);
                await updateConfigFieldDirect('app_info.changelog', changelog);
                
                log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è APK –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('new-version').value = '';
                document.getElementById('changelog').value = '';
                document.getElementById('update-required').checked = false;
                document.getElementById('apk-file').value = '';
                
                setTimeout(loadCurrentConfig, 2000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ APK: ${error.message}`);
            }
        }

        async function updateSecurity() {
            const domains = document.getElementById('security-domains').value;
            
            if (!domains.trim()) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
                return;
            }
            
            log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...');
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π security_config.xml
                const response = await fetch('./files/security_config.xml');
                let currentXML = await response.text();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –¥–æ–º–µ–Ω—ã
                const domainList = domains.split('\n').filter(d => d.trim());
                let xmlDomains = '';
                
                domainList.forEach(domain => {
                    const cleanDomain = domain.trim();
                    if (cleanDomain) {
                        xmlDomains += `        <domain includeSubdomains="true">${cleanDomain}</domain>\n`;
                    }
                });
                
                // –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –¥–æ–º–µ–Ω—ã –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º </domain-config>
                const updatedXML = currentXML.replace(
                    '</domain-config>',
                    xmlDomains + '    </domain-config>'
                );
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
                await updateGitHubFile('files/security_config.xml', updatedXML, `üîí –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ${domainList.length} –Ω–æ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤`);
                
                log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${domainList.length} –¥–æ–º–µ–Ω–æ–≤!`);
                document.getElementById('security-domains').value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤: ${error.message}`);
            }
        }

        // ===== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ß–ï–†–ï–ó GITHUB API =====
        
        async function updateConfigFieldDirect(field, value) {
            try {
                log(`üîç DEBUG: updateConfigFieldDirect –≤—ã–∑–≤–∞–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: field="${field}", value=${value} (—Ç–∏–ø: ${typeof value})`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π config.json —Å GitHub API
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/api/config.json?ref=main&t=${Date.now()}`, {
                    headers: {
                        'Authorization': `token ${authToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: HTTP ${response.status}`);
                }
                
                const fileData = await response.json();
                const configContent = atob(fileData.content);
                const config = JSON.parse(configContent);
                log(`üîç DEBUG: –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ${field}: ${config.service_config?.service_available}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ
                const keys = field.split('.');
                let obj = config;
                for (let i = 0; i < keys.length - 1; i++) {
                    if (!obj[keys[i]]) {
                        throw new Error(`–ü–æ–ª–µ ${keys.slice(0, i+1).join('.')} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏`);
                    }
                    obj = obj[keys[i]];
                }
                
                log(`üîç DEBUG: –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ ${value} –≤ –ø–æ–ª–µ ${field}`);
                obj[keys[keys.length - 1]] = value;
                log(`üîç DEBUG: –ü–æ—Å–ª–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è: ${obj[keys[keys.length - 1]]}`);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
                const updatedContent = JSON.stringify(config, null, 4);
                log(`üîç DEBUG: –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ GitHub —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º: service_available = ${config.service_config?.service_available}`);
                await updateGitHubFile('api/config.json', updatedContent, `üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${field} = ${value}`);
                
                log(`‚úÖ ${field} –æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ ${value}`);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ${field}: ${error.message}`);
                throw error;
            }
        }
        
        async function updateGitHubFile(filePath, content, commitMessage, isBinary = false) {
            try {
                log(`üîç DEBUG: updateGitHubFile –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è —Ñ–∞–π–ª–∞ ${filePath}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // 1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª –¥–ª—è SHA
                const fileResponse = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/${filePath}`, {
                    headers: {
                        'Authorization': `token ${authToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                if (fileResponse.ok) {
                    const fileData = await fileResponse.json();
                    sha = fileData.sha;
                } else if (fileResponse.status === 404) {
                    // –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
                    log(`üìù –§–∞–π–ª ${filePath} –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π`);
                } else {
                    throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª ${filePath}: HTTP ${fileResponse.status}`);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                if (filePath === 'api/config.json') {
                    const configPreview = JSON.parse(content);
                    log(`üîç DEBUG: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ GitHub: service_available = ${configPreview.service_config?.service_available}`);
                }
                
                // 2. –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª
                const updateResponse = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${authToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: commitMessage,
                        content: isBinary ? content : btoa(unescape(encodeURIComponent(content))), // –î–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ content —É–∂–µ base64
                        sha: sha,
                        branch: 'main'
                    })
                });
                
                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json();
                    let errorMessage = `GitHub API –æ—à–∏–±–∫–∞: ${errorData.message}`;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫
                    if (updateResponse.status === 401) {
                        errorMessage += '\nüîë –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω GitHub - –≤–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –∏—Å—Ç–µ–∫';
                    } else if (updateResponse.status === 403) {
                        errorMessage += '\nüîê –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ - —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å';
                    } else if (updateResponse.status === 409) {
                        errorMessage += '\nüîÑ –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                log(`‚úÖ –§–∞–π–ª ${filePath} –æ–±–Ω–æ–≤–ª–µ–Ω`);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ ${filePath}: ${error.message}`);
                throw error;
            }
        }

        function log(message) {
            const logDiv = document.getElementById('operation-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `\n[${timestamp}] ${message}`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ===== –°–ò–°–¢–ï–ú–ê –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò =====
        let authToken = localStorage.getItem('github-token');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            if (authToken) {
                verifyToken(authToken);
            }
        };

        async function authenticate() {
            const token = document.getElementById('auth-token').value.trim();
            const errorDiv = document.getElementById('auth-error');
            
            if (!token) {
                showAuthError('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω');
                return;
            }
            
            errorDiv.style.display = 'none';
            document.querySelector('#auth-container .btn').textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            const isValid = await verifyToken(token);
            
            if (isValid) {
                authToken = token;
                localStorage.setItem('github-token', token);
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                loadCurrentConfig();
                setInterval(loadCurrentConfig, 120000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
            } else {
                document.querySelector('#auth-container .btn').textContent = 'üîì –í–æ–π—Ç–∏';
                showAuthError('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é');
            }
        }

        async function verifyToken(token) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
                const response = await fetch('https://api.github.com/repos/artemon4es/tv-channels-api', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const repo = await response.json();
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É —Ç–æ–∫–µ–Ω–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
                    return repo.permissions && repo.permissions.push;
                }
                
                return false;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:', error);
                return false;
            }
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('auth-error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('github-token');
            authToken = null;
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('auth-token').value = '';
        }

        // Enter key –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('auth-container').classList.contains('hidden')) {
                authenticate();
            }
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
        // loadCurrentConfig(); - —É–±—Ä–∞–Ω–æ, –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
        // setInterval(loadCurrentConfig, 30000); - —É–±—Ä–∞–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    </script>
    </div> <!-- –ó–∞–∫—Ä—ã—Ç–∏–µ main-content -->
</body>
</html> 