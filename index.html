<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß IPTV Control Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            margin: 100px auto;
        }
        .auth-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .hidden { display: none !important; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 5px;
        }
        .online { background: #d4edda; color: #155724; }
        .offline { background: #f8d7da; color: #721c24; }
        .service-status-big {
            background: #f8f9fa;
            border: 3px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .service-status-big.offline {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        .service-status-big.online {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        .service-status-big.changed {
            animation: statusChange 1s ease-in-out;
        }
        @keyframes statusChange {
            0% { transform: scale(1); box-shadow: none; }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(0,0,0,0.3); }
            100% { transform: scale(1); box-shadow: none; }
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            box-sizing: border-box;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
        }
        .api-endpoint {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        code { background: #e9ecef; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="auth-container" class="auth-container">
        <h1>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ GitHub Personal Access Token –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</p>
        <input type="password" id="auth-token" class="auth-input" placeholder="GitHub Personal Access Token" autocomplete="off">
        <button class="btn btn-success" onclick="authenticate()" style="width: 100%; margin-top: 10px;">üîì –í–æ–π—Ç–∏</button>
        <div id="auth-error" style="color: red; margin-top: 10px; display: none;"></div>
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; font-size: 12px; text-align: left;">
            <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:</strong><br>
            1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings ‚Üí Tokens</a><br>
            2. –°–æ–∑–¥–∞–π—Ç–µ Personal Access Token<br>
            3. –í—ã–±–µ—Ä–∏—Ç–µ scopes: <code>repo</code>, <code>workflow</code><br>
            4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤–≤–µ–¥–∏—Ç–µ –≤—ã—à–µ
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="main-content" class="hidden">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
        <div class="container">
            <h1>üîß IPTV Control Panel</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IPTV –∫–∞–Ω–∞–ª–∞–º–∏ –¥–ª—è Android TV</p>
            <div style="text-align: right;">
                <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
            <div id="service-status"></div>
        </div>

    <!-- –¢–∞–±—ã -->
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('public')">üìä –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
            <button class="tab" onclick="showTab('admin')">üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="public" class="tab-content active">
            <h2>üìã API Endpoints</h2>
            
            <div class="api-endpoint">
                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                <code>GET /api/config.json</code>
                <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å–µ —Å–µ—Ä–≤–∏—Å–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–∞–Ω–∞–ª–æ–≤</p>
            </div>
            
            <div class="api-endpoint">
                <h3>–°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤</h3>
                <code>GET /files/channels.m3u8</code>
                <p>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ IPTV –∫–∞–Ω–∞–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ M3U8</p>
            </div>
            
            <div class="api-endpoint">
                <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <code>GET /files/security_config.xml</code>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è Android</p>
            </div>
            
            <h2>üì± –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h2>
            <p>–ë–∞–∑–æ–≤—ã–π URL: <code>https://artemon4es.github.io/tv-channels-api</code></p>
            <p>API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</p>
            
            <h2>üîß –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
            <div id="system-status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button onclick="loadCurrentConfig()" style="margin-top: 10px; background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ -->
        <div id="admin" class="tab-content">
            <div class="control-panel">
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º -->
                <div class="section">
                    <h3>üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º</h3>
                    <div id="admin-service-status" class="service-status-big">
                        üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...
                    </div>
                    <button class="btn btn-success" onclick="enableService()">‚úÖ –í–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å</button>
                    <button class="btn btn-danger" onclick="disableService()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å</button>
                    <button class="btn" onclick="loadCurrentConfig()" style="background: #6c757d;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                    <br><br>
                    <div style="padding: 15px; background: #f0f8ff; border-radius: 5px; border-left: 4px solid #007bff;">
                        <p style="margin: 0; font-size: 14px; color: #0056b3;">
                            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:<br>
                            <em>"–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."</em>
                        </p>
                    </div>
                    <div style="padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107; margin-top: 10px;">
                        <p style="margin: 0; font-size: 14px; color: #856404;">
                            <strong>‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ GitHub Pages:</strong> –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 10 –º–∏–Ω—É—Ç –∏–∑-–∑–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è GitHub Pages. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
                        </p>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ -->
                <div class="section">
                    <h3>üì∫ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏</h3>
                    
                    <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ -->
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h4>üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫</h4>
                        <p style="margin: 5px 0; font-size: 14px; color: #0056b3;">
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="auto-update-status">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                        </p>
                        <div style="margin-top: 10px;">
                            <input type="url" id="source-url" placeholder="https://example.com/playlist.m3u8" style="width: 70%; margin-right: 10px;">
                            <button class="btn btn-success" onclick="setupAutoUpdate()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
                        </div>
                        <div style="margin-top: 10px;">
                            <button class="btn" onclick="checkSourceChanges()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ–π—á–∞—Å</button>
                            <button class="btn btn-danger" onclick="disableAutoUpdate()">‚èπÔ∏è –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            ‚è∞ –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞: 2 —Ä–∞–∑–∞ –≤ —Å—É—Ç–∫–∏ (08:00 –∏ 20:00 UTC)
                        </div>
                    </div>
                    
                    <!-- –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ URL -->
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                        <h4>üîß –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ URL</h4>
                        <div style="margin-top: 10px;">
                            <input type="url" id="manual-url" placeholder="https://example.com/playlist.m3u8" style="width: 70%; margin-right: 10px;">
                            <button class="btn btn-success" onclick="updateChannelsFromURL()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–∞–Ω–∞–ª—ã</button>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #856404;">
                            üí° –ë—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
                        </div>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
                    <div id="channels-update-status" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 12px; color: #666;">
                        üìä –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å
                    </div>
                    
                    <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
                    <div style="border-top: 1px solid #dee2e6; padding-top: 15px;">
                        <h4>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</h4>
                        <input type="file" id="channels-file" accept=".m3u8,.m3u">
                        <button class="btn" onclick="uploadChannels()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–Ω–∞–ª—ã</button>
                        <br><br>
                        <h4>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                        <textarea id="channels-content" style="height: 120px;"></textarea>
                        <button class="btn btn-success" onclick="saveChannels()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ APK -->
                <div class="section">
                    <h3>üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ APK</h3>
                    <input type="text" id="new-version" placeholder="1.2" style="width: 100px;">
                    <input type="file" id="apk-file" accept=".apk">
                    <button class="btn btn-success" onclick="uploadAPK()">–ó–∞–≥—Ä—É–∑–∏—Ç—å APK</button>
                    <br><br>
                    <label>Changelog:</label>
                    <textarea id="changelog" placeholder="üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏\n‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" style="height: 60px;"></textarea>
                    <label>
                        <input type="checkbox" id="update-required"> –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    </label>
                </div>

                <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
                <div class="section">
                    <h3>üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                    <textarea id="security-domains" placeholder="example.com&#10;cdn.example.com" style="height: 80px;"></textarea>
                    <button class="btn" onclick="updateSecurity()">–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–º–µ–Ω—ã</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π -->
    <div class="container">
        <h2>üìã –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <div id="operation-log" class="log">
            [–°–ò–°–¢–ï–ú–ê] Control Panel –∑–∞–≥—Ä—É–∂–µ–Ω
        </div>
        <button onclick="document.getElementById('operation-log').innerHTML = '[–°–ò–°–¢–ï–ú–ê] –õ–æ–≥ –æ—á–∏—â–µ–Ω'; log('üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω');" 
                style="margin-top: 10px; background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
            üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
        </button>
    </div>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        let previousServiceStatus = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function loadCurrentConfig() {
            try {
                log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
                let config = null;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ GitHub API (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω)
                if (authToken) {
                    try {
                        log('üîç –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ GitHub API...');
                        const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/api/config.json?ref=main&t=${Date.now()}`, {
                            headers: {
                                'Authorization': `Bearer ${authToken}`,
                                'X-GitHub-Api-Version': '2022-11-28',
                                'Accept': 'application/vnd.github.v3+json',
                                'Cache-Control': 'no-cache'
                            }
                        });
                        
                        if (response.ok) {
                            const fileData = await response.json();
                            const configContent = atob(fileData.content);
                            config = JSON.parse(configContent);
                            log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ GitHub API');
                        } else {
                            log(`‚ö†Ô∏è GitHub API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (${response.status}), –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥`);
                        }
                    } catch (apiError) {
                        log(`‚ö†Ô∏è GitHub API –æ—à–∏–±–∫–∞: ${apiError.message}, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥`);
                    }
                } else {
                    log('‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
                
                // –ï—Å–ª–∏ GitHub API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ GitHub Pages
                if (!config) {
                    try {
                        log('üîç –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ GitHub Pages...');
                        const response = await fetch(`https://artemon4es.github.io/tv-channels-api/api/config.json?t=${Date.now()}`, {
                            headers: {
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0'
                            }
                        });
                        
                        if (response.ok) {
                            config = await response.json();
                            log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ GitHub Pages');
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (pagesError) {
                        throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: ${pagesError.message}`);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
                const currentStatus = config.service_config.service_available;
                if (previousServiceStatus !== null && previousServiceStatus !== currentStatus) {
                    // –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    const statusText = currentStatus ? '–≤–∫–ª—é—á–µ–Ω' : '–æ—Ç–∫–ª—é—á–µ–Ω';
                    log(`üîÑ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ –∏–∑–º–µ–Ω–µ–Ω: ${statusText}`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    document.title = `${currentStatus ? 'üü¢' : 'üî¥'} IPTV Control Panel - –°–µ—Ä–≤–∏—Å ${statusText}`;
                    setTimeout(() => {
                        document.title = 'üîß IPTV Control Panel';
                    }, 5000);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    setTimeout(() => {
                        const statusDiv = document.getElementById('service-status');
                        const adminStatusDiv = document.getElementById('admin-service-status');
                        
                        if (statusDiv) {
                            const bigStatus = statusDiv.querySelector('.service-status-big');
                            if (bigStatus) {
                                bigStatus.classList.add('changed');
                                setTimeout(() => bigStatus.classList.remove('changed'), 1000);
                            }
                        }
                        
                        if (adminStatusDiv) {
                            adminStatusDiv.classList.add('changed');
                            setTimeout(() => adminStatusDiv.classList.remove('changed'), 1000);
                        }
                    }, 100);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
                previousServiceStatus = currentStatus;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateServiceStatus(config);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–Ω–∞–ª–æ–≤
                try {
                    log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤...');
                    const channelsResponse = await fetch('https://artemon4es.github.io/tv-channels-api/files/channels.m3u8?' + Date.now());
                    if (channelsResponse.ok) {
                        const channelsContent = await channelsResponse.text();
                        if (document.getElementById('channels-content')) {
                            document.getElementById('channels-content').value = channelsContent;
                        }
                        log('‚úÖ –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    } else {
                        log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–Ω–∞–ª—ã: HTTP ${channelsResponse.status}`);
                    }
                } catch (channelsError) {
                    log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–Ω–∞–ª–æ–≤: ${channelsError.message}`);
                }
                
                // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—ã —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—É–±—Ä–∞–Ω–æ –ø–æ–ª–µ service-message)
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                const systemStatusElement = document.getElementById('system-status');
                if (systemStatusElement && config) {
                    systemStatusElement.innerHTML = `
                        <p><strong>–°–µ—Ä–≤–∏—Å:</strong> ${config.service_config.service_available ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</p>
                        <p><strong>–í–µ—Ä—Å–∏—è –∫–∞–Ω–∞–ª–æ–≤:</strong> ${config.channels_config.version}</p>
                        <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> ${new Date(config.channels_config.last_updated).toLocaleString()}</p>
                        <p><strong>–í–µ—Ä—Å–∏—è APK:</strong> ${config.app_info.current_version} ‚Üí ${config.app_info.latest_version}</p>
                    `;
                }
                
                if (config) {
                    log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞');
                } else {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∏ –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º');
                }
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + error.message);
                log('üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏
                const statusDiv = document.getElementById('service-status');
                if (statusDiv) {
                    statusDiv.innerHTML = `
                        <div class="service-status-big offline">
                            ‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
                            <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                                ${error.message}
                            </div>
                        </div>
                    `;
                }
            }
        }

        function updateServiceStatus(config) {
            const statusDiv = document.getElementById('service-status');
            const adminStatusDiv = document.getElementById('admin-service-status');
            const isOnline = config.service_config.service_available;
            
            // –ë–æ–ª—å—à–æ–π —Å—Ç–∞—Ç—É—Å –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏
            statusDiv.innerHTML = `
                <div class="service-status-big ${isOnline ? 'online' : 'offline'}">
                    ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –ê–ö–¢–ò–í–ï–ù' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ï–ù'}
                    <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                        ${isOnline ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —ç–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏'}
                    </div>
                </div>
                <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                    <span class="status-indicator ${isOnline ? 'online' : 'offline'}">
                        ${isOnline ? 'üü¢ –°–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –°–µ—Ä–≤–∏—Å –æ—Ç–∫–ª—é—á–µ–Ω'}
                    </span>
                    <span style="background: #e9ecef; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                        üì∫ –ö–∞–Ω–∞–ª—ã: v${config.channels_config.version}
                    </span>
                    <span style="background: #e9ecef; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                        üì± APK: v${config.app_info.current_version} ‚Üí v${config.app_info.latest_version}
                    </span>
                </div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
            if (adminStatusDiv) {
                adminStatusDiv.className = `service-status-big ${isOnline ? 'online' : 'offline'}`;
                adminStatusDiv.innerHTML = `
                    ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –ê–ö–¢–ò–í–ï–ù' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ï–ù'}
                    <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                        ${isOnline ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —ç–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏'}
                    </div>
                `;
            }
        }

        async function enableService() {
            log('üîÑ –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞...');
            log('üîç DEBUG: –í—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è enableService()');
            
            try {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
                verifyConfigChange.attempts = 0;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è GitHub API
                if (!authToken) {
                    log('‚ö†Ô∏è –¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ.');
                    log('üí° –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ GitHub
                log('üîç DEBUG: –í—ã–∑—ã–≤–∞–µ–º updateConfigFieldDirect —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º TRUE');
                await updateConfigFieldDirect('service_config.service_available', true);
                await updateConfigFieldDirect('service_config.message', '');
                log('‚úÖ –°–µ—Ä–≤–∏—Å –≤–∫–ª—é—á–µ–Ω!');
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                showServiceStatusChange(true, '');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è GitHub Pages)
                setTimeout(async () => {
                    await verifyConfigChange(true);
                }, 5000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞: ${error.message}`);
                
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–æ–∫–µ–Ω–æ–º, –¥–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                if (error.message.includes('token') || error.message.includes('401') || error.message.includes('403')) {
                    log('üîë –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω GitHub –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    log('üí° –í–æ–∑–º–æ–∂–Ω–æ, —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞');
                } else {
                    log('üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥');
                }
                
                // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
                setTimeout(loadCurrentConfig, 2000);
            }
        }

        async function disableService() {
            log('üîÑ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞...');
            log('üîç DEBUG: –í—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è disableService()');
            
            try {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
                verifyConfigChange.attempts = 0;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è GitHub API
                if (!authToken) {
                    log('‚ö†Ô∏è –¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ.');
                    log('üí° –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ GitHub
                log('üîç DEBUG: –í—ã–∑—ã–≤–∞–µ–º updateConfigFieldDirect —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º FALSE');
                await updateConfigFieldDirect('service_config.service_available', false);
                await updateConfigFieldDirect('service_config.message', '');
                log('‚ùå –°–µ—Ä–≤–∏—Å –æ—Ç–∫–ª—é—á–µ–Ω!');
                
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                showServiceStatusChange(false, '');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è GitHub Pages)
                setTimeout(async () => {
                    await verifyConfigChange(false);
                }, 5000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞: ${error.message}`);
                
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–æ–∫–µ–Ω–æ–º, –¥–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                if (error.message.includes('token') || error.message.includes('401') || error.message.includes('403')) {
                    log('üîë –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω GitHub –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    log('üí° –í–æ–∑–º–æ–∂–Ω–æ, —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞');
                } else {
                    log('üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥');
                }
                
                // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
                setTimeout(loadCurrentConfig, 2000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function showServiceStatusChange(isOnline, message) {
            const statusDiv = document.getElementById('service-status');
            const adminStatusDiv = document.getElementById('admin-service-status');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.title = `${isOnline ? 'üü¢' : 'üî¥'} IPTV Control Panel - ${isOnline ? '–í–∫–ª—é—á–∞–µ–º' : '–û—Ç–∫–ª—é—á–∞–µ–º'} —Å–µ—Ä–≤–∏—Å...`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞–ø—Ä—è–º—É—é –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div class="service-status-big ${isOnline ? 'online' : 'offline'} changed">
                        ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –í–ö–õ–Æ–ß–ê–ï–¢–°–Ø...' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ê–ï–¢–°–Ø...'}
                        <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                            ${isOnline ? '–û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...' : '–ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                        <span class="status-indicator ${isOnline ? 'online' : 'offline'}">
                            ${isOnline ? 'üü¢ –í–∫–ª—é—á–µ–Ω–∏–µ...' : 'üî¥ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ...'}
                        </span>
                        <span style="background: #ffc107; color: #212529; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                            ‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...
                        </span>
                    </div>
                `;
            }
            
            if (adminStatusDiv) {
                adminStatusDiv.className = `service-status-big ${isOnline ? 'online' : 'offline'} changed`;
                adminStatusDiv.innerHTML = `
                    ${isOnline ? 'üü¢ –°–ï–†–í–ò–° –í–ö–õ–Æ–ß–ê–ï–¢–°–Ø...' : 'üî¥ –°–ï–†–í–ò–° –û–¢–ö–õ–Æ–ß–ê–ï–¢–°–Ø...'}
                    <div style="font-size: 14px; margin-top: 10px; font-weight: normal;">
                        ${isOnline ? '–û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...' : '–ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...'}
                    </div>
                `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function verifyConfigChange(expectedStatus) {
            try {
                log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
                
                let config = null;
                
                // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ GitHub API (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω)
                if (authToken) {
                    try {
                        const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/api/config.json?ref=main&t=${Date.now()}`, {
                            headers: {
                                'Authorization': `Bearer ${authToken}`,
                                'X-GitHub-Api-Version': '2022-11-28',
                                'Accept': 'application/vnd.github.v3+json',
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0'
                            }
                        });
                        
                        if (response.ok) {
                            const fileData = await response.json();
                            const decodedContent = atob(fileData.content);
                            config = JSON.parse(decodedContent);
                            log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ GitHub API');
                        } else {
                            log(`‚ö†Ô∏è GitHub API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (${response.status}), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥`);
                        }
                    } catch (apiError) {
                        log(`‚ö†Ô∏è GitHub API –æ—à–∏–±–∫–∞: ${apiError.message}, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥`);
                    }
                }
                
                // –ï—Å–ª–∏ GitHub API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
                if (!config) {
                    try {
                        const response = await fetch(`./api/config.json?t=${Date.now()}`, {
                            headers: {
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0'
                            }
                        });
                        
                        if (response.ok) {
                            config = await response.json();
                            log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ GitHub Pages');
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (pagesError) {
                        throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: ${pagesError.message}`);
                    }
                }
                
                const actualStatus = config.service_config.service_available;
                
                if (actualStatus === expectedStatus) {
                    log('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
                    verifyConfigChange.attempts = 0;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    updateServiceStatus(config);
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    document.title = 'üîß IPTV Control Panel';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —É—Å–ø–µ—Ö–∞
                    const statusDiv = document.getElementById('service-status');
                    const adminStatusDiv = document.getElementById('admin-service-status');
                    
                    if (statusDiv) {
                        const bigStatus = statusDiv.querySelector('.service-status-big');
                        if (bigStatus) {
                            bigStatus.classList.add('changed');
                            setTimeout(() => bigStatus.classList.remove('changed'), 1000);
                        }
                    }
                    
                    if (adminStatusDiv) {
                        adminStatusDiv.classList.add('changed');
                        setTimeout(() => adminStatusDiv.classList.remove('changed'), 1000);
                    }
                    
                } else {
                    log(`‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å. –û–∂–∏–¥–∞–µ–º: ${expectedStatus}, –ø–æ–ª—É—á–∏–ª–∏: ${actualStatus}`);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
                    if (!verifyConfigChange.attempts) {
                        verifyConfigChange.attempts = 0;
                    }
                    verifyConfigChange.attempts++;
                    
                                         if (verifyConfigChange.attempts < 10) {
                         // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                         const delay = Math.min(5000 + (verifyConfigChange.attempts * 2000), 15000);
                         log(`üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ ${delay/1000} —Å–µ–∫—É–Ω–¥... (–ø–æ–ø—ã—Ç–∫–∞ ${verifyConfigChange.attempts}/10)`);
                         
                         // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å–ª–µ 3-—Ö –ø–æ–ø—ã—Ç–æ–∫
                         if (verifyConfigChange.attempts >= 3) {
                             log('üí° –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - GitHub Pages –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π. –ü–æ–¥–æ–∂–¥–∏—Ç–µ...');
                         }
                         
                         setTimeout(async () => {
                             await verifyConfigChange(expectedStatus);
                         }, delay);
                     } else {
                        log('‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ (10)');
                        log('üí° GitHub Pages –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–æ 10 –º–∏–Ω—É—Ç. –ò–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.');
                        log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ...');
                        
                        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –æ–∂–∏–¥–∞–µ–º—ã–º —Å—Ç–∞—Ç—É—Å–æ–º
                        const mockConfig = {
                            service_config: {
                                service_available: expectedStatus,
                                message: ''
                            },
                            channels_config: { version: 'loading...' },
                            app_info: { 
                                current_version: 'loading...',
                                latest_version: 'loading...'
                            }
                        };
                        updateServiceStatus(mockConfig);
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
                        verifyConfigChange.attempts = 0;
                        
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                        document.title = 'üîß IPTV Control Panel';
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
                        setTimeout(loadCurrentConfig, 30000);
                    }
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${error.message}`);
                log('üîÑ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–±—ã—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                verifyConfigChange.attempts = 0;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
                setTimeout(loadCurrentConfig, 2000);
            }
        }

        // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï —Ñ—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
        async function saveChannels() {
            const content = document.getElementById('channels-content').value;
            
            if (!content.includes('#EXTM3U')) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å #EXTM3U');
                return;
            }
            
            log('üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ GitHub Actions...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º GitHub Action –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/actions/workflows/update-channels.yml/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: 'main',
                        inputs: {
                            channels_content: content
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
                    throw new Error(`GitHub Actions –æ—à–∏–±–∫–∞: ${errorData.message}`);
                }
                
                log('‚úÖ GitHub Action –∑–∞–ø—É—â–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤');
                log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è... (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥)');
                
                // –ñ–¥–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                await waitForChannelsUpdate();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤: ${error.message}`);
            }
        }

        function uploadChannels() {
            const channelsFile = document.getElementById('channels-file').files[0];
            
            if (!channelsFile) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∫–∞–Ω–∞–ª–æ–≤');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                if (!content.includes('#EXTM3U')) {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å #EXTM3U');
                    return;
                }
                
                document.getElementById('channels-content').value = content;
                log(`üì∫ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${channelsFile.name}`);
                saveChannels();
            };
            reader.readAsText(channelsFile);
        }

        async function uploadAPK() {
            const newVersion = document.getElementById('new-version').value;
            const changelog = document.getElementById('changelog').value;
            const updateRequired = document.getElementById('update-required').checked;
            const apkFile = document.getElementById('apk-file').files[0];
            
            if (!newVersion) {
                alert('‚ùå –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é APK');
                return;
            }
            
            if (!apkFile) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ APK —Ñ–∞–π–ª');
                return;
            }
            
            log(`üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ APK v${newVersion} —á–µ—Ä–µ–∑ GitHub Actions (${(apkFile.size / 1024 / 1024).toFixed(1)} MB)...`);
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ binary –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64
                const arrayBuffer = await apkFile.arrayBuffer();
                const base64Content = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º GitHub Action –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è APK
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/actions/workflows/update-apk.yml/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: 'main',
                        inputs: {
                            version: newVersion,
                            changelog: changelog,
                            update_required: updateRequired.toString(),
                            apk_base64: base64Content
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
                    throw new Error(`GitHub Actions –æ—à–∏–±–∫–∞: ${errorData.message}`);
                }
                
                log('‚úÖ GitHub Action –∑–∞–ø—É—â–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ APK');
                log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è... (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã)');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('new-version').value = '';
                document.getElementById('changelog').value = '';
                document.getElementById('update-required').checked = false;
                document.getElementById('apk-file').value = '';
                
                // –ñ–¥–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                await waitForAPKUpdate(newVersion);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ APK: ${error.message}`);
            }
        }

        async function updateSecurity() {
            const domains = document.getElementById('security-domains').value;
            
            if (!domains.trim()) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
                return;
            }
            
            log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ GitHub Actions...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º GitHub Action –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/actions/workflows/update-security.yml/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: 'main',
                        inputs: {
                            domains: domains
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
                    throw new Error(`GitHub Actions –æ—à–∏–±–∫–∞: ${errorData.message}`);
                }
                
                const domainCount = domains.split('\n').filter(d => d.trim()).length;
                log(`‚úÖ GitHub Action –∑–∞–ø—É—â–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è ${domainCount} –¥–æ–º–µ–Ω–æ–≤`);
                log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è... (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥)');
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
                document.getElementById('security-domains').value = '';
                
                // –ñ–¥–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                setTimeout(() => {
                    log('‚úÖ –î–æ–º–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                }, 30000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤: ${error.message}`);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        async function waitForChannelsUpdate() {
            const maxAttempts = 12;
            let attempts = 0;
            
            while (attempts < maxAttempts) {
                attempts++;
                
                try {
                    await new Promise(resolve => setTimeout(resolve, 10000));
                    log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤... (–ø–æ–ø—ã—Ç–∫–∞ ${attempts}/${maxAttempts})`);
                    
                    const response = await fetch(`https://artemon4es.github.io/tv-channels-api/files/channels.m3u8?t=${Date.now()}`, {
                        headers: { 'Cache-Control': 'no-cache' }
                    });
                    
                    if (response.ok) {
                        const newChannels = await response.text();
                        const currentChannels = document.getElementById('channels-content').value;
                        
                        if (newChannels !== currentChannels) {
                            log('‚úÖ –ö–∞–Ω–∞–ª—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                            document.getElementById('channels-content').value = newChannels;
                            setTimeout(loadCurrentConfig, 2000);
                            return;
                        }
                    }
                    
                } catch (error) {
                    log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`);
                }
            }
            
            log('‚ö†Ô∏è –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Actions –≤—Ä—É—á–Ω—É—é.');
        }

        async function waitForAPKUpdate(expectedVersion) {
            const maxAttempts = 12;
            let attempts = 0;
            
            while (attempts < maxAttempts) {
                attempts++;
                
                try {
                    await new Promise(resolve => setTimeout(resolve, 15000));
                    log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è APK... (–ø–æ–ø—ã—Ç–∫–∞ ${attempts}/${maxAttempts})`);
                    
                    const response = await fetch(`https://artemon4es.github.io/tv-channels-api/api/config.json?t=${Date.now()}`, {
                        headers: { 'Cache-Control': 'no-cache' }
                    });
                    
                    if (response.ok) {
                        const config = await response.json();
                        if (config.app_info && config.app_info.latest_version === expectedVersion) {
                            log(`‚úÖ APK v${expectedVersion} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!`);
                            setTimeout(loadCurrentConfig, 2000);
                            return;
                        }
                    }
                    
                } catch (error) {
                    log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`);
                }
            }
            
            log('‚ö†Ô∏è –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Actions –≤—Ä—É—á–Ω—É—é.');
        }

        // ===== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ß–ï–†–ï–ó GITHUB ACTIONS =====
        
        async function updateConfigFieldDirect(field, value) {
            log(`üîç DEBUG: updateConfigFieldDirect –≤—ã–∑–≤–∞–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: field="${field}", value=${value} (—Ç–∏–ø: ${typeof value})`);
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º GitHub Action –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/actions/workflows/update-config.yml/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: 'main',
                        inputs: {
                            field: field,
                            value: value.toString()
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
                    let errorMessage = `GitHub Actions –æ—à–∏–±–∫–∞: ${errorData.message}`;
                    
                    if (response.status === 401) {
                        errorMessage += '\nüîë –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω GitHub - –≤–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –∏—Å—Ç–µ–∫';
                    } else if (response.status === 403) {
                        errorMessage += '\nüîê –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ - —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ actions';
                    } else if (response.status === 404) {
                        errorMessage += '\nüìÅ Workflow –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .github/workflows/update-config.yml';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                log(`‚úÖ GitHub Action –∑–∞–ø—É—â–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ${field} = ${value}`);
                log(`‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è... (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥)`);
                
                // –ñ–¥–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Action (–ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
                await waitForActionCompletion(field, value);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ${field}: ${error.message}`);
                throw error;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è GitHub Action
        async function waitForActionCompletion(field, expectedValue) {
            const maxAttempts = 12; // 2 –º–∏–Ω—É—Ç—ã –º–∞–∫—Å–∏–º—É–º
            let attempts = 0;
            
            while (attempts < maxAttempts) {
                attempts++;
                
                try {
                    // –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
                    await new Promise(resolve => setTimeout(resolve, 10000));
                    
                    log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞... (–ø–æ–ø—ã—Ç–∫–∞ ${attempts}/${maxAttempts})`);
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    const response = await fetch(`https://artemon4es.github.io/tv-channels-api/api/config.json?t=${Date.now()}`, {
                        headers: {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        }
                    });
                    
                    if (response.ok) {
                        const config = await response.json();
                        const keys = field.split('.');
                        let value = config;
                        
                        for (const key of keys) {
                            if (value && typeof value === 'object' && key in value) {
                                value = value[key];
                            } else {
                                value = undefined;
                                break;
                            }
                        }
                        
                        if (value === expectedValue) {
                            log(`‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã! ${field} = ${value}`);
                            updateServiceStatus(config);
                            return;
                        } else {
                            log(`‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ... —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${value}, –æ–∂–∏–¥–∞–µ–º: ${expectedValue}`);
                        }
                    } else {
                        log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: HTTP ${response.status}`);
                    }
                    
                } catch (error) {
                    log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`);
                }
            }
            
            log(`‚ö†Ô∏è –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. GitHub Action –º–æ–∂–µ—Ç –≤—Å–µ –µ—â–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è.`);
            log(`üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.`);
        }

        function log(message) {
            const logDiv = document.getElementById('operation-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `\n[${timestamp}] ${message}`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è PowerShell –∫–æ–º–∞–Ω–¥—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    log('‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(() => {
                    log('‚ö†Ô∏è –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤—Ä—É—á–Ω—É—é');
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    log('‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                } catch (err) {
                    log('‚ö†Ô∏è –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤—Ä—É—á–Ω—É—é');
                }
                document.body.removeChild(textArea);
            }
        }

        // ===== –°–ò–°–¢–ï–ú–ê –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò =====
        let authToken = localStorage.getItem('github-token');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            if (authToken) {
                verifyToken(authToken);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            initializeAutoUpdateStatus();
        };

        async function authenticate() {
            const token = document.getElementById('auth-token').value.trim();
            const errorDiv = document.getElementById('auth-error');
            
            if (!token) {
                showAuthError('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω');
                return;
            }
            
            errorDiv.style.display = 'none';
            document.querySelector('#auth-container .btn').textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            const isValid = await verifyToken(token);
            
            if (isValid) {
                authToken = token;
                localStorage.setItem('github-token', token);
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                loadCurrentConfig();
                setInterval(loadCurrentConfig, 120000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                initializeAutoUpdateStatus();
            } else {
                document.querySelector('#auth-container .btn').textContent = 'üîì –í–æ–π—Ç–∏';
                showAuthError('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é');
            }
        }

        async function verifyToken(token) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
                const response = await fetch('https://api.github.com/repos/artemon4es/tv-channels-api', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const repo = await response.json();
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É —Ç–æ–∫–µ–Ω–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –∏ actions
                    const hasWriteAccess = repo.permissions && repo.permissions.push;
                    
                    if (hasWriteAccess) {
                        log('‚úÖ –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä–µ–Ω: –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π');
                        log('üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞: repo, workflow, actions');
                        return true;
                    } else {
                        log('‚ùå –¢–æ–∫–µ–Ω –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π');
                        return false;
                    }
                }
                
                return false;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:', error);
                return false;
            }
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('auth-error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('github-token');
            authToken = null;
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('auth-token').value = '';
        }

        // Enter key –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('auth-container').classList.contains('hidden')) {
                authenticate();
            }
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
        // loadCurrentConfig(); - —É–±—Ä–∞–Ω–æ, –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
        // setInterval(loadCurrentConfig, 30000); - —É–±—Ä–∞–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

        // ===== –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –ò –†–£–ß–ù–û–ì–û –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ö–ê–ù–ê–õ–û–í =====

        // –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (–∏–∑ custom.m3u8)
        const TARGET_CHANNELS = [
            { id: 'pervy', name: '–ü–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª HD', keywords: ['–ü–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª', '1TV', '–ü–µ—Ä–≤', '–ü–µ—Ä–≤—ã–π'] },
            { id: 'rossia1', name: '–†–æ—Å—Å–∏—è 1 HD', keywords: ['–†–æ—Å—Å–∏—è 1', 'Rossiya', 'Russia 1'] },
            { id: 'rossia-24', name: '–†–æ—Å—Å–∏—è-24', keywords: ['–†–æ—Å—Å–∏—è-24', 'Rossiya-24', 'Russia-24'] },
            { id: 'kultura', name: '–†–æ—Å—Å–∏—è –ö—É–ª—å—Ç—É—Ä–∞', keywords: ['–†–æ—Å—Å–∏—è –ö—É–ª—å—Ç—É—Ä–∞', 'Kultura', 'Russia K'] },
            { id: 'ntv', name: '–ù–¢–í HD', keywords: ['–ù–¢–í', 'NTV'] },
            { id: 'tnt', name: '–¢–ù–¢ HD', keywords: ['–¢–ù–¢', 'TNT'] },
            { id: 'sts', name: '–°–¢–° HD', keywords: ['–°–¢–°', 'STS'] },
            { id: 'tv3-ru', name: '–¢–í-3 HD', keywords: ['–¢–í-3', 'TV3', 'TV-3'] },
            { id: 'zvezda', name: '–ó–≤–µ–∑–¥–∞ HD', keywords: ['–ó–≤–µ–∑–¥–∞', 'Zvezda'] },
            { id: 'rentv', name: '–†–µ–Ω –¢–í HD', keywords: ['–†–µ–Ω –¢–í', 'REN TV', 'REN-TV'] },
            { id: 'tvcentr', name: '–¢–í –¶–µ–Ω—Ç—Ä HD', keywords: ['–¢–í –¶–µ–Ω—Ç—Ä', 'TV Center', 'TV Centre'] },
            { id: '5kanal-ru', name: '5 –∫–∞–Ω–∞–ª –†–æ—Å—Å–∏—è', keywords: ['5 –∫–∞–Ω–∞–ª', '5-–π –∫–∞–Ω–∞–ª', '5-kanal'] },
            { id: 'domashny', name: '–î–æ–º–∞—à–Ω–∏–π HD', keywords: ['–î–æ–º–∞—à–Ω–∏–π', 'Domashny'] },
            { id: 'pyatnica', name: '–ü—è—Ç–Ω–∏—Ü–∞ HD', keywords: ['–ü—è—Ç–Ω–∏—Ü–∞', 'Friday'] },
            { id: 'mir', name: '–ú–∏—Ä HD', keywords: ['–ú–∏—Ä', 'Mir'] },
            { id: 'otr', name: '–û–¢–† HD', keywords: ['–û–¢–†', 'OTR'] },
            { id: 'rbk', name: '–†–ë–ö', keywords: ['–†–ë–ö', 'RBK'] },
            { id: 'spas', name: '–°–ø–∞—Å', keywords: ['–°–ø–∞—Å', 'Spas'] },
            { id: 'karusel', name: '–ö–∞—Ä—É—Å–µ–ª—å HD', keywords: ['–ö–∞—Ä—É—Å–µ–ª—å', 'Karusel'] },
            { id: 'muztv', name: '–ú—É–∑ –¢–í HD', keywords: ['–ú—É–∑ –¢–í', 'MuzTV', 'MTV'] },
            { id: 'match-tv', name: '–ú–∞—Ç—á! HD', keywords: ['–ú–∞—Ç—á!', 'Match!', 'Match TV'] }
        ];

        // –ü–∞—Ä—Å–∏–Ω–≥ M3U —Ñ–∞–π–ª–∞
        function parseM3UFile(content) {
            const lines = content.split('\n');
            const channels = [];
            let currentChannel = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    // –ü–∞—Ä—Å–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–Ω–∞–ª–µ
                    const tvgIdMatch = line.match(/tvg-id="([^"]*)"/);
                    const tvgLogoMatch = line.match(/tvg-logo="([^"]*)"/);
                    const groupTitleMatch = line.match(/group-title="([^"]*)"/);
                    const nameMatch = line.match(/,(.+)$/);
                    
                    currentChannel = {
                        extinf: line,
                        tvgId: tvgIdMatch ? tvgIdMatch[1] : '',
                        tvgLogo: tvgLogoMatch ? tvgLogoMatch[1] : '',
                        groupTitle: groupTitleMatch ? groupTitleMatch[1] : '',
                        name: nameMatch ? nameMatch[1] : '',
                        url: ''
                    };
                } else if (line && !line.startsWith('#') && currentChannel) {
                    // URL –∫–∞–Ω–∞–ª–∞
                    currentChannel.url = line;
                    channels.push(currentChannel);
                    currentChannel = null;
                }
            }
            
            return channels;
        }

        // –ü–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–∞ –≤ —Å–ø–∏—Å–∫–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        function findChannelByKeywords(channelName, targetChannels) {
            const normalizedName = channelName.toLowerCase();
            
            for (const target of targetChannels) {
                for (const keyword of target.keywords) {
                    if (normalizedName.includes(keyword.toLowerCase())) {
                        return target;
                    }
                }
            }
            
            return null;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        async function updateChannelsFromURL() {
            const url = document.getElementById('manual-url').value.trim();
            
            if (!url) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞');
                return;
            }
            
            if (!url.match(/^https?:\/\/.+\.(m3u8?|txt)$/i)) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å .m3u8 –∏–ª–∏ .m3u');
                return;
            }
            
            log(`üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏–∑: ${url}`);
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
                if (!authToken) {
                    throw new Error('–¢–æ–∫–µ–Ω GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.');
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤
                const currentChannels = await getCurrentChannelsFromGitHub();
                if (!currentChannels) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ URL
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: HTTP ${response.status}`);
                }
                
                const newContent = await response.text();
                if (!newContent.includes('#EXTM3U')) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ - –Ω–µ –Ω–∞–π–¥–µ–Ω #EXTM3U');
                }
                
                // –ü–∞—Ä—Å–∏–º –æ–±–∞ —Ñ–∞–π–ª–∞
                const currentChannelsParsed = parseM3UFile(currentChannels);
                const newChannelsParsed = parseM3UFile(newContent);
                
                log(`üìä –¢–µ–∫—É—â–∏–µ –∫–∞–Ω–∞–ª—ã: ${currentChannelsParsed.length}, –Ω–æ–≤—ã–µ: ${newChannelsParsed.length}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫–∏
                const updatedChannels = updateChannelUrls(currentChannelsParsed, newChannelsParsed);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
                await saveUpdatedChannels(updatedChannels);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateChannelsStatus(`–û–±–Ω–æ–≤–ª–µ–Ω–æ –≤—Ä—É—á–Ω—É—é –∏–∑ ${new URL(url).hostname}`, updatedChannels.updated);
                
                log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –û–±–Ω–æ–≤–ª–µ–Ω–æ ${updatedChannels.updated} –∫–∞–Ω–∞–ª–æ–≤`);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ –∏–∑ GitHub
        async function getCurrentChannelsFromGitHub() {
            try {
                const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/contents/files/channels.m3u8?ref=main&t=${Date.now()}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Accept': 'application/vnd.github.v3+json',
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (response.ok) {
                    const fileData = await response.json();
                    return atob(fileData.content);
                }
                
                throw new Error(`HTTP ${response.status}`);
            } catch (error) {
                log(`‚ö†Ô∏è Fallback: –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ GitHub Pages`);
                const response = await fetch(`https://artemon4es.github.io/tv-channels-api/files/channels.m3u8?t=${Date.now()}`);
                if (response.ok) {
                    return await response.text();
                }
                throw error;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –∫–∞–Ω–∞–ª–æ–≤
        function updateChannelUrls(currentChannels, newChannels) {
            let updated = 0;
            const updatedChannels = [];
            
            for (const current of currentChannels) {
                let channelUpdated = false;
                
                // –ò—â–µ–º –∫–∞–Ω–∞–ª –≤ –Ω–æ–≤–æ–º —Å–ø–∏—Å–∫–µ
                const targetChannel = findChannelByKeywords(current.name, TARGET_CHANNELS);
                if (targetChannel) {
                    // –ò—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–∞–Ω–∞–ª –≤ –Ω–æ–≤–æ–º —Å–ø–∏—Å–∫–µ
                    for (const newChannel of newChannels) {
                        if (findChannelByKeywords(newChannel.name, [targetChannel])) {
                            // –ù–∞–π–¥–µ–Ω –∫–∞–Ω–∞–ª - –æ–±–Ω–æ–≤–ª—è–µ–º URL
                            if (current.url !== newChannel.url) {
                                log(`üîÑ –û–±–Ω–æ–≤–ª—è–µ–º "${current.name}": ${current.url.substring(0, 50)}... ‚Üí ${newChannel.url.substring(0, 50)}...`);
                                current.url = newChannel.url;
                                channelUpdated = true;
                                updated++;
                            }
                            break;
                        }
                    }
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–Ω–∞–ª –≤ –Ω–æ–≤–æ–º —Å–ø–∏—Å–∫–µ
                updatedChannels.push(current);
            }
            
            return {
                channels: updatedChannels,
                updated: updated
            };
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
        async function saveUpdatedChannels(result) {
            // –§–æ—Ä–º–∏—Ä—É–µ–º M3U —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            let content = '#EXTM3U\n';
            
            for (const channel of result.channels) {
                content += `${channel.extinf}\n`;
                content += `${channel.url}\n\n`;
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º GitHub Action –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const response = await fetch(`https://api.github.com/repos/artemon4es/tv-channels-api/actions/workflows/update-channels.yml/dispatches`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'X-GitHub-Api-Version': '2022-11-28',
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    ref: 'main',
                    inputs: {
                        channels_content: content
                    }
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
                throw new Error(`GitHub Actions –æ—à–∏–±–∫–∞: ${errorData.message}`);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º textarea
            document.getElementById('channels-content').value = content;
            
            log('‚úÖ GitHub Action –∑–∞–ø—É—â–µ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤');
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        async function setupAutoUpdate() {
            const url = document.getElementById('source-url').value.trim();
            
            if (!url) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
                return;
            }
            
            if (!url.match(/^https?:\/\/.+\.(m3u8?|txt)$/i)) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å .m3u8 –∏–ª–∏ .m3u');
                return;
            }
            
            log(`‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è: ${url}`);
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≤ localStorage
                localStorage.setItem('auto-update-url', url);
                localStorage.setItem('auto-update-enabled', 'true');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                document.getElementById('auto-update-status').textContent = `–ê–∫—Ç–∏–≤–Ω–æ (${new URL(url).hostname})`;
                document.getElementById('auto-update-status').style.color = '#28a745';
                
                log('‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ');
                log('‚è∞ –°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –≤ 08:00 –∏–ª–∏ 20:00 UTC');
                
                // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                await checkSourceChanges();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
        async function checkSourceChanges() {
            const url = localStorage.getItem('auto-update-url');
            
            if (!url) {
                log('‚ö†Ô∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ');
                return;
            }
            
            log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ: ${url}`);
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ö–µ—à –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const lastHash = localStorage.getItem('auto-update-last-hash');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const content = await response.text();
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Ö–µ—à —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
                const currentHash = await calculateHash(content);
                
                if (lastHash === currentHash) {
                    log('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –Ω–µ—Ç');
                    return;
                }
                
                log('üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–Ω–∞–ª—ã...');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–Ω–∞–ª—ã
                document.getElementById('manual-url').value = url;
                await updateChannelsFromURL();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π —Ö–µ—à
                localStorage.setItem('auto-update-last-hash', currentHash);
                localStorage.setItem('auto-update-last-check', new Date().toISOString());
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ${error.message}`);
            }
        }

        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function disableAutoUpdate() {
            localStorage.removeItem('auto-update-url');
            localStorage.removeItem('auto-update-enabled');
            localStorage.removeItem('auto-update-last-hash');
            localStorage.removeItem('auto-update-last-check');
            
            document.getElementById('auto-update-status').textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ';
            document.getElementById('auto-update-status').style.color = '#dc3545';
            
            log('‚èπÔ∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤
        function updateChannelsStatus(message, updatedCount) {
            const statusDiv = document.getElementById('channels-update-status');
            const timestamp = new Date().toLocaleString();
            
            statusDiv.innerHTML = `
                üìä ${message} (${timestamp})
                ${updatedCount ? `<br>üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–Ω–∞–ª–æ–≤: ${updatedCount}` : ''}
            `;
            
            if (updatedCount > 0) {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
            } else {
                statusDiv.style.background = '#f8f9fa';
                statusDiv.style.color = '#666';
            }
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        async function calculateHash(content) {
            const encoder = new TextEncoder();
            const data = encoder.encode(content);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function initializeAutoUpdateStatus() {
            const isEnabled = localStorage.getItem('auto-update-enabled') === 'true';
            const url = localStorage.getItem('auto-update-url');
            const lastCheck = localStorage.getItem('auto-update-last-check');
            
            if (isEnabled && url) {
                document.getElementById('auto-update-status').textContent = `–ê–∫—Ç–∏–≤–Ω–æ (${new URL(url).hostname})`;
                document.getElementById('auto-update-status').style.color = '#28a745';
                document.getElementById('source-url').value = url;
                
                if (lastCheck) {
                    const lastCheckDate = new Date(lastCheck);
                    updateChannelsStatus(`–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞: ${lastCheckDate.toLocaleString()}`, 0);
                }
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
        setInterval(() => {
            const now = new Date();
            const hour = now.getUTCHours();
            const minute = now.getUTCMinutes();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ 08:00 –∏ 20:00 UTC (¬±1 –º–∏–Ω—É—Ç–∞)
            if ((hour === 8 || hour === 20) && minute <= 1) {
                const isEnabled = localStorage.getItem('auto-update-enabled') === 'true';
                if (isEnabled) {
                    log('‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...');
                    checkSourceChanges();
                }
            }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    </script>
    </div> <!-- –ó–∞–∫—Ä—ã—Ç–∏–µ main-content -->
</body>
</html> 
